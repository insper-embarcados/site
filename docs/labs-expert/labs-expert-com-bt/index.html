<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
      
        <title>Labs expert com bt - Computação Embarcada - 2.0</title>
      
    
    <link rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Fira+Sans+Extra+Condensed:700|Oxygen+Mono|Source+Sans+Pro:700|Source+Serif+Pro&amp;display=swap">
    <link rel="stylesheet" href="../../assets/css/main.css">
    <script>
      // SETUP GLOBAL CONSTANTS
      var base_url = '../..';
      
      var telemetryEnabled = false;
      var backendUrl = "";
      var courseSlug = "";
      
      
      var dashboardEnabled = true;
      var tagTree = [{'reference': ['choice-exercise', 'parsons-exercise', 'text-exercise']}, {'grandparent-tag': [{'parent-tag': ['child-tag']}]}];
      

      // SETUP PLUGIN
      window.initialized = false;
      if (!window.initializers) window.initializers = [];
      window.registerInitializer = (initialize) => {
        if (window.initialized) initialize();
        else window.initializers.push(initialize);
      };
    </script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          processEscapes: true
        }
      });
    </script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="https://unpkg.com/hyperscript.org"></script>
    <script src="https://unpkg.com/htmx.org@1.8.4"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="../../assets/js/main.js"></script>
    
    <link rel="stylesheet" href="../../termynal.css">
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        </style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  <body>
    <div class="ah-main-container">
      <header class="ah-header">
        <button class="ah-menu-btn ah-button ah-button--borderless"
                aria-label="toggle menu">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
  <!--! Font Awesome Pro 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
  <path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/>
</svg>
        </button>
        <a href="../.."
           title="Computação Embarcada - 2.0"
           class="ah-logo"
           aria-label="Computação Embarcada - 2.0">
          Computação Embarcada - 2.0
        </a>
        <div class="ah-header--right">
          
          
          
          <button id="resetHandoutButton">
            <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-trash3" viewBox="0 0 16 16">
  <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"/>
</svg></span>
          </button>
          

          
        </div>
      </header>
      <nav class="ah-navigation preload">
        <div class="ah-nav-container">
          <button class="ah-menu-btn ah-button ah-button--borderless close-menu"
                  aria-label="close menu">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">
  <!--! Font Awesome Pro 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
  <path d="M310.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L160 210.7 54.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L114.7 256 9.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 301.3 265.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L205.3 256 310.6 150.6z"/>
</svg>
          </button>
          <ul class="ah-nav-body">
            
              
  
    <li>
      <a href="../..">Home</a>
    </li>
  

            
              
  
    <li>
      <a href="../../aulas/">Aulas</a>
    </li>
  

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Avaliação</span>
    <ul>
      
        
  
    <li>
      <a href="../../avaliacao/">Critério</a>
    </li>
  

      
        
  
    <li>
      <a href="../../simulados/">Prática</a>
    </li>
  

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Infra</span>
    <ul>
      
        
  
    <li>
      <a href="../../infra-linux-docker/">Linux ou Mac</a>
    </li>
  

      
        
  
    <li>
      <a href="../../infra-windows/">Windows</a>
    </li>
  

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Prototipando</span>
    <ul>
      
        
  
    <li>
      <a href="../../prototipos/prototipos/">Fabricação</a>
    </li>
  

      
        
  
    <li>
      <a href="../../prototipos/entradas/">Entradas</a>
    </li>
  

      
        
  
    <li>
      <a href="../../prototipos/saida.md">Saídas</a>
    </li>
  

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Utils</span>
    <ul>
      
        
  
    <li>
      <a href="../../utils/utils-uinput/">Uinput</a>
    </li>
  

      
        
  
    <li>
      <a href="../../utils/utils-pyautogui/">pyautogui</a>
    </li>
  

      
        
  
    <li>
      <a href="../../utils/utils-vjoy/">vjoy</a>
    </li>
  

      
        
  
    <li>
      <a href="../../utils/utils-volume/">Volume</a>
    </li>
  

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Dispositivos</span>
    <ul>
      
        
  
    <li>
      <a href="../../dispositivos/buzzer/">Buzzer</a>
    </li>
  

      
        
  
    <li>
      <a href="https://perrobotica.fandom.com/pt-br/wiki/Sensor_de_dist%C3%A2ncia_Hcsr04">HC-SR04</a>
    </li>
  

      
        
  
    <li>
      <a href="../../dispositivos/oled1/">OLED1</a>
    </li>
  

      
        
  
    <li>
      <a href="../../dispositivos/servo/">Servomotor</a>
    </li>
  

      
        
  
    <li>
      <a href="../../dispositivos/analogicos/">Análogicos</a>
    </li>
  

      
        
  
    <li>
      <a href="../../dispositivos/hc06/">HC-06</a>
    </li>
  

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Pico W</span>
    <ul>
      
        
  
    <li>
      <a href="https://datasheets.raspberrypi.com/picow/pico-w-datasheet.pdf">Datasheet</a>
    </li>
  

      
        
  
    <li>
      <a href="https://www.raspberrypi.com/documentation/microcontrollers/images/picow-pinout.svg">Hardware</a>
    </li>
  

      
        
  
    <li>
      <a href="../../pico/pico-examples/">pico-examples</a>
    </li>
  

      
        
  
    <li>
      <a href="../../pico/pico-debugging/">Programando</a>
    </li>
  

      
        
  
    <li>
      <a href="../../pico/pico-wifi/">WIFI</a>
    </li>
  

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">RP2040</span>
    <ul>
      
        
  
    <li>
      <a href="https://datasheets.raspberrypi.com/rp2040/rp2040-datasheet.pdf">Datasheet</a>
    </li>
  

      
        
  
    <li>
      <a href="https://www.raspberrypi.com/documentation/pico-sdk/index_doxygen.html">SDK</a>
    </li>
  

      
        
  
    <li>
      <a href="../../rp2040/rp2040-delay/">Delay</a>
    </li>
  

      
        
  
    <li>
      <a href="../../rp2040/rp2040-gpio/">GPIO</a>
    </li>
  

      
        
  
    <li>
      <a href="../../rp2040/rp2040-gpio-irq/">GPIO IRQ</a>
    </li>
  

      
        
  
    <li>
      <a href="../../rp2040/rp2040-timer/">Timer</a>
    </li>
  

      
        
  
    <li>
      <a href="../../rp2040/rp2040-rtc/">RTC</a>
    </li>
  

      
        
  
    <li>
      <a href="https://kevinboone.me/picoflash.html">Flash</a>
    </li>
  

      
        
  
    <li>
      <a href="../../rp2040/rp2040-adc/">ADC</a>
    </li>
  

      
        
  
    <li>
      <a href="../../rp2040/rp2040-pwm/">PWM</a>
    </li>
  

      
        
  
    <li>
      <a href="../../rp2040/rp2040-i2c/">I2C</a>
    </li>
  

      
        
  
    <li>
      <a href="../../rp2040/rp2040-dma/">DMA</a>
    </li>
  

      
        
  
    <li>
      <a href="../../rp2040/rp2040-uart/">UART</a>
    </li>
  

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">FreeRTOS</span>
    <ul>
      
        
  
    <li>
      <a href="../../freertos/freertos-basic/">RTOS</a>
    </li>
  

      
        
  
    <li>
      <a href="../../freertos/freertos-tasks/">Tasks</a>
    </li>
  

      
        
  
    <li>
      <a href="../../freertos/freertos-vtaskDelay/">VtaskDelay</a>
    </li>
  

      
        
  
    <li>
      <a href="../../freertos/freertos-software-time/">Software Timer</a>
    </li>
  

      
        
  
    <li>
      <a href="../../freertos/freertos-semaphore/">Semaphore</a>
    </li>
  

      
        
  
    <li>
      <a href="../../freertos/freertos-queue/">Queue</a>
    </li>
  

      
        
  
    <li>
      <a href="../../freertos/freertos-queue-advanced/">Queue struct</a>
    </li>
  

      
        
  
    <li>
      <a href="../../freertos/freertos-smp/">SMP</a>
    </li>
  

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Code quality</span>
    <ul>
      
        
  
    <li>
      <a href="../../CodeQuality/topview/">Visão geral</a>
    </li>
  

      
        
  
    <li>
      <a href="../../CodeQuality/rules/">Regras</a>
    </li>
  

      
        
  
    <li>
      <a href="../../CodeQuality/cppcheck/">Cppcheck</a>
    </li>
  

      
        
  
    <li>
      <a href="../../CodeQuality/variables/">Variáveis</a>
    </li>
  

      
        
  
    <li>
      <a href="../../CodeQuality/isr-variables/">ISR - variáveis</a>
    </li>
  

      
        
  
    <li>
      <a href="../../CodeQuality/isr-handler/">ISR - handler</a>
    </li>
  

      
        
  
    <li>
      <a href="../../CodeQuality/head-file/">Head File</a>
    </li>
  

      
        
  
    <li>
      <a href="../../CodeQuality/rtos/">RTOS</a>
    </li>
  

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Labs core</span>
    <ul>
      
        
  
    <li>
      <a href="../../labs/pre-lab/">Preparatórios</a>
    </li>
  

      
        
  
    <li>
      <a href="../../labs/pra-lab/">Prática</a>
    </li>
  

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">GPIO</span>
    <ul>
      
        
  
    <li>
      <a href="../../labs/qualidade-codigo-1">⏰ Qualidade de Código</a>
    </li>
  

      
        
  
    <li>
      <a href="../../labs/gpio-pre-lab/">⏰ Preparatório</a>
    </li>
  

      
        
  
    <li>
      <a href="../../labs/gpio-pra-lab/">Prática</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">ISR</span>
    <ul>
      
        
  
    <li>
      <a href="../../labs/qualidade-codigo-irs">⏰ Qualidade de Código</a>
    </li>
  

      
        
  
    <li>
      <a href="../../labs/irq-pre-lab/">⏰ Preparatório</a>
    </li>
  

      
        
  
    <li>
      <a href="../../labs/irq-pra-lab/">Prática</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Timer</span>
    <ul>
      
        
  
    <li>
      <a href="../../labs/timer-pre-lab/">⏰ Preparatório</a>
    </li>
  

      
        
  
    <li>
      <a href="../../labs/timer-pra-lab/">Prática</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">RTOS</span>
    <ul>
      
        
  
    <li>
      <a href="../../labs/rtos-pre-lab/">⏰ Preparatório</a>
    </li>
  

      
        
  
    <li>
      <a href="../../labs/rtos-pra-lab/">Prática</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">ADC/PWM</span>
    <ul>
      
        
  
    <li>
      <a href="../../labs/adc-pwm-pre-lab/">Preparatório</a>
    </li>
  

      
        
  
    <li>
      <a href="../../labs/adc-pwm-pra-lab/">Prática</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">I2C</span>
    <ul>
      
        
  
    <li>
      <a href="../../labs/i2c-pre-lab/">Preparatório</a>
    </li>
  

      
        
  
    <li>
      <a href="../../labs/i2c-pra-lab/">Prática</a>
    </li>
  

      
    </ul>
  </li>

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">APS</span>
    <ul>
      
        
  
    <li>
      <a href="../../aps/aps-1-genius/">Aps 1 genius</a>
    </li>
  

      
        
  
    <li>
      <a href="../../aps/aps-2-controle/">Aps 2 controle</a>
    </li>
  

      
    </ul>
  </li>

            
          </ul>
        </div>
      </nav>
      <main class="ah-content ah-typeset">
        
          <div class="ah-title-box">
            <ul class="ah-breadcrumbs">
              
                
                <li></li>
            </ul>
            
            
          </div>
          
            <section class="progress-section show">
<h1 id="expert-bluetooth">Expert - Bluetooth</h1>
<table>
<thead>
<tr>
<th>Lab Expert - Bluetooth</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Deadline</strong>: None</td>
</tr>
<tr>
<td><a href="None">Repositório no Classroom</a></td>
</tr>
<tr>
<td>💰 100% nota de lab</td>
</tr>
</tbody>
</table>
<p>Neste laboratório vamos explorar os recursos de conectividade <code>Bluetooth</code> da <code>Raspberry Pi Pico W</code>. </p>
<h3 id="definicoes">Definições</h3>
<p>Já conhecemos a tecnologia Bluetooth, inclusive usamos em nosso curso por meio do módulo HC05/HC06. </p>
<p>Se já conhecemos e usamos bluetooth, por que vamos voltar nesse assunto? Bem, é chegada a hora de aprofundarmos nosso conhecimento um pouco mais na tecnologia bluetooth e aproveitar para conhecer como usar o modulo bluetooth da pico W.</p>
<p>A Raspberry Pi Pico W possui a versão 5.2 do Bluetooth, que é a especificação do módulo CYW43439 de wifi/bt. O modulo possui o modo BLE (Bluetooth Low Energy) que oferece melhorias em termos de velocidade, alcance e eficiência energética. </p>
<table>
<thead>
<tr>
<th>Característica</th>
<th>CYW43439 (Pico W)</th>
<th>HC-05/HC-06</th>
</tr>
</thead>
<tbody>
<tr>
<td>Versão Bluetooth</td>
<td>Bluetooth 5.2</td>
<td>Bluetooth 2.0</td>
</tr>
<tr>
<td>Modos de Operação</td>
<td>BLE (Bluetooth Low Energy)</td>
<td>Bluetooth Clássico</td>
</tr>
<tr>
<td>Taxa de Transferência</td>
<td>Mais alta devido ao BLE e Bluetooth 5.2</td>
<td>Limitada (Bluetooth 2.0)</td>
</tr>
<tr>
<td>Energia</td>
<td>Mais eficiente (BLE)</td>
<td>Menos eficiente</td>
</tr>
<tr>
<td>Alcance</td>
<td>Maior alcance (BLE e Bluetooth 5.2)</td>
<td>Menor alcance</td>
</tr>
<tr>
<td>Facilidade de Uso</td>
<td>Mais complexo, mas mais funcionalidades</td>
<td>Mais simples, ideal para iniciantes</td>
</tr>
<tr>
<td>Modos de Conexão</td>
<td>Central e Periférico</td>
<td>Mestre (HC-05) e Escravo</td>
</tr>
<tr>
<td>Interfacing</td>
<td>SPI</td>
<td>UART (serial)</td>
</tr>
</tbody>
</table>
<h3 id="comunicacao-bluetooth-le">Comunicação Bluetooth LE</h3>
<p>Bluetooth Low Energy (BLE) foi introduzido como parte da especificação Bluetooth 4.0, projetado para oferecer uma alternativa de baixo consumo de energia ao Bluetooth clássico, e tenta ser uma alternativa para aplicações que requerem comunicação sem fio eficiente em termos de energia, como dispositivos vestíveis, sensores e dispositivos IoT (Internet das Coisas).</p>
<p>A medida que começamos a nos aprofundar no sistema bluetooth, vamos nos deparar com uma verdadeira sopa de letrinhas, isso por que o sistema bluetooth é bem complexo e requer conhecimento e diversos protocolos aplicados em diversas camadas. </p>
<p>De acordo com a propria especificação, o sistema Bluetooth é composto por um Host, um Controlador Primário e zero ou mais Controladores Secundários. Uma implementação mínima do sistema core Bluetooth BR/EDR cobre as quatro camadas mais baixas e os protocolos associados definidos pela especificação Bluetooth, bem como um protocolo de camada de serviço comum; o Service Discovery Protocol (SDP). Os requisitos gerais do perfil são especificados no Generic Access Profile (GAP). O sistema core BR/EDR inclui suporte para Alternate MAC/PHYs (AMPs), incluindo um AMP Manager Protocol e Protocol Adaptation Layers (PALs) que suportam MAC/PHYs referenciados externamente. Uma implementação mínima de um sistema core apenas Bluetooth LE cobre as quatro camadas mais baixas e os protocolos associados definidos pela especificação Bluetooth, bem como dois protocolos comuns de camada de serviço; o Security Manager (SM) e o Attribute Protocol (ATT). Os requisitos gerais do perfil são especificados no Generic Attribute Profile (GATT) e no Generic Access Profile (GAP).</p>
<p>Fica calmo que vamos tentar desvendadr alguns desses protocólos. </p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Entender alguns desses protocolos é importante pois ajuda a entender melhor alguns dos exemplos disponiveis no próprio <a href="https://github.com/raspberrypi/pico-examples/tree/master">site da raspberry pico</a>.</p>
</div>
<h3 id="comunicacao-ble">Comunicação BLE</h3>
<p>Aplicação: <code>Lê o sensor de temperatura integrado na pico W e envia notificações via BLE, além de pisca a cada segundo para mostrar que está funcionando.</code></p>
<p>Neste exemplo vamos configurar o Generic Access Profile (GAP), que basicamente define como os dispositivos BLE descobrem e se conectam uns aos outros, no modo de operação broadcast (anúncios). Permitindo que dispositivos BLE enviem pacotes de dados de anúncio para serem descobertos por outros dispositivos.</p>
<p>Comece ajustando a infra necessária:</p>
<p>No <code>Cmakelist.txt</code> configure da seguinte forma:</p>
<div class="language-sh highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># configura a placa com wifi</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>set<span class="o">(</span>PICO_BOARD<span class="w"> </span>pico_w<span class="o">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>add_executable<span class="o">(</span>main
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span>main.c<span class="w"> </span>server_common.c
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="o">)</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>target_link_libraries<span class="o">(</span>main
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">    </span>pico_stdlib
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">    </span>pico_btstack_ble
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">    </span>pico_btstack_cyw43
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="w">    </span>pico_cyw43_arch_none
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="w">    </span>hardware_adc
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="w">    </span><span class="o">)</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>target_include_directories<span class="o">(</span>main<span class="w"> </span>PRIVATE
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="w">    </span><span class="si">${</span><span class="nv">CMAKE_CURRENT_LIST_DIR</span><span class="si">}</span><span class="w"> </span><span class="c1"># For btstack config</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="w">    </span><span class="o">)</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>pico_btstack_make_gatt_header<span class="o">(</span>main<span class="w"> </span>PRIVATE<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CMAKE_CURRENT_LIST_DIR</span><span class="si">}</span><span class="s2">/temp_sensor.gatt&quot;</span><span class="o">)</span>
</code></pre></div>
<p>Carregue no diretório main os arquivos de apoio do projeto.</p>
<ul>
<li><a href="https://github.com/raspberrypi/pico-examples/blob/master/pico_w/bt/standalone/btstack_config.h">btstack_config.h</a></li>
<li><a href="https://github.com/raspberrypi/pico-examples/blob/master/pico_w/bt/standalone/lwipopts.h">lwipopts.h</a></li>
<li><a href="https://github.com/raspberrypi/pico-examples/blob/master/pico_w/bt/standalone/temp_sensor.gatt">temp_sensor.gatt</a></li>
<li><a href="https://github.com/raspberrypi/pico-examples/blob/master/pico_w/bt/standalone/server_common.h">server_common.h</a></li>
<li><a href="https://github.com/raspberrypi/pico-examples/blob/master/pico_w/bt/standalone/server_common.c">server_common.c</a></li>
</ul>
<p>o nosso código principal é o seguinte: </p>
<details>
<summary>Código base</summary>
<div class="language-C highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="cm">/**</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="cm">* Levemente adaptado para o nosso curso </span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="cm">* Copyright (c) 2023 Raspberry Pi (Trading) Ltd.</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="cm">*</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="cm">* SPDX-License-Identifier: BSD-3-Clause</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="cm">*/</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;btstack.h&quot;</span><span class="c1"> //funcionalidades de Bluetooth.</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;pico/cyw43_arch.h&quot;</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;pico/btstack_cyw43.h&quot;</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;hardware/adc.h&quot;</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;pico/stdlib.h&quot;</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;server_common.h&quot;</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="cp">#define HEARTBEAT_PERIOD_MS 1000</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="k">static</span><span class="w"> </span><span class="n">btstack_timer_source_t</span><span class="w"> </span><span class="n">heartbeat</span><span class="p">;</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="k">static</span><span class="w"> </span><span class="n">btstack_packet_callback_registration_t</span><span class="w"> </span><span class="n">hci_event_callback_registration</span><span class="p">;</span>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">heartbeat_handler</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">btstack_timer_source</span><span class="w"> </span><span class="o">*</span><span class="n">ts</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="w">    </span><span class="n">counter</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="w">    </span><span class="c1">// Update the temp every 10s</span>
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">counter</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="w">        </span><span class="n">poll_temp</span><span class="p">();</span>
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">le_notification_enabled</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a><span class="w">            </span><span class="n">att_server_request_can_send_now_event</span><span class="p">(</span><span class="n">con_handle</span><span class="p">);</span>
<a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a>
<a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a><span class="w">    </span><span class="c1">// Invert the led</span>
<a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">led_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a><span class="w">    </span><span class="n">led_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">led_on</span><span class="p">;</span>
<a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a><span class="w">    </span><span class="n">cyw43_arch_gpio_put</span><span class="p">(</span><span class="n">CYW43_WL_GPIO_LED_PIN</span><span class="p">,</span><span class="w"> </span><span class="n">led_on</span><span class="p">);</span>
<a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a>
<a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a><span class="w">    </span><span class="c1">// Restart timer</span>
<a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a><span class="w">    </span><span class="n">btstack_run_loop_set_timer</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span><span class="w"> </span><span class="n">HEARTBEAT_PERIOD_MS</span><span class="p">);</span>
<a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a><span class="w">    </span><span class="n">btstack_run_loop_add_timer</span><span class="p">(</span><span class="n">ts</span><span class="p">);</span>
<a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a><span class="p">}</span>
<a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a>
<a id="__codelineno-1-44" name="__codelineno-1-44" href="#__codelineno-1-44"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-45" name="__codelineno-1-45" href="#__codelineno-1-45"></a><span class="w">    </span><span class="n">stdio_init_all</span><span class="p">();</span>
<a id="__codelineno-1-46" name="__codelineno-1-46" href="#__codelineno-1-46"></a>
<a id="__codelineno-1-47" name="__codelineno-1-47" href="#__codelineno-1-47"></a><span class="w">    </span><span class="c1">// initialize CYW43 driver architecture (will enable BT if/because CYW43_ENABLE_BLUETOOTH == 1)</span>
<a id="__codelineno-1-48" name="__codelineno-1-48" href="#__codelineno-1-48"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cyw43_arch_init</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-49" name="__codelineno-1-49" href="#__codelineno-1-49"></a><span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;failed to initialise cyw43_arch</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<a id="__codelineno-1-50" name="__codelineno-1-50" href="#__codelineno-1-50"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<a id="__codelineno-1-51" name="__codelineno-1-51" href="#__codelineno-1-51"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-52" name="__codelineno-1-52" href="#__codelineno-1-52"></a>
<a id="__codelineno-1-53" name="__codelineno-1-53" href="#__codelineno-1-53"></a><span class="w">    </span><span class="c1">// Inicializa a leitura do sensor de temperatura, </span>
<a id="__codelineno-1-54" name="__codelineno-1-54" href="#__codelineno-1-54"></a><span class="w">    </span><span class="c1">// esse sensor já vem embutido na placa, não precisamos adicionar nenhum sensor na placa.</span>
<a id="__codelineno-1-55" name="__codelineno-1-55" href="#__codelineno-1-55"></a><span class="w">    </span><span class="n">adc_init</span><span class="p">();</span>
<a id="__codelineno-1-56" name="__codelineno-1-56" href="#__codelineno-1-56"></a><span class="w">    </span><span class="n">adc_select_input</span><span class="p">(</span><span class="n">ADC_CHANNEL_TEMPSENSOR</span><span class="p">);</span>
<a id="__codelineno-1-57" name="__codelineno-1-57" href="#__codelineno-1-57"></a><span class="w">    </span><span class="n">adc_set_temp_sensor_enabled</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
<a id="__codelineno-1-58" name="__codelineno-1-58" href="#__codelineno-1-58"></a>
<a id="__codelineno-1-59" name="__codelineno-1-59" href="#__codelineno-1-59"></a><span class="w">    </span><span class="n">l2cap_init</span><span class="p">();</span><span class="w"> </span><span class="c1">// Inicializa o L2CAP (Logical Link Control and Adaptation Protocol) </span>
<a id="__codelineno-1-60" name="__codelineno-1-60" href="#__codelineno-1-60"></a><span class="w">    </span><span class="n">sm_init</span><span class="p">();</span><span class="w"> </span><span class="c1">// Inicializa o SM (Security Manager) do Bluetooth.</span>
<a id="__codelineno-1-61" name="__codelineno-1-61" href="#__codelineno-1-61"></a>
<a id="__codelineno-1-62" name="__codelineno-1-62" href="#__codelineno-1-62"></a><span class="w">    </span><span class="c1">// Inicializar o servidor ATT (Attribute Protocol)</span>
<a id="__codelineno-1-63" name="__codelineno-1-63" href="#__codelineno-1-63"></a><span class="w">    </span><span class="c1">// com o perfil GATT definido (profile_data) e os callbacks de leitura e escrita.</span>
<a id="__codelineno-1-64" name="__codelineno-1-64" href="#__codelineno-1-64"></a><span class="w">    </span><span class="n">att_server_init</span><span class="p">(</span><span class="n">profile_data</span><span class="p">,</span><span class="w"> </span><span class="n">att_read_callback</span><span class="p">,</span><span class="w"> </span><span class="n">att_write_callback</span><span class="p">);</span>
<a id="__codelineno-1-65" name="__codelineno-1-65" href="#__codelineno-1-65"></a>
<a id="__codelineno-1-66" name="__codelineno-1-66" href="#__codelineno-1-66"></a><span class="w">    </span><span class="c1">// Registrar callbacks BTstack state</span>
<a id="__codelineno-1-67" name="__codelineno-1-67" href="#__codelineno-1-67"></a><span class="w">    </span><span class="n">hci_event_callback_registration</span><span class="p">.</span><span class="n">callback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">packet_handler</span><span class="p">;</span>
<a id="__codelineno-1-68" name="__codelineno-1-68" href="#__codelineno-1-68"></a><span class="w">    </span><span class="n">hci_add_event_handler</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hci_event_callback_registration</span><span class="p">);</span>
<a id="__codelineno-1-69" name="__codelineno-1-69" href="#__codelineno-1-69"></a>
<a id="__codelineno-1-70" name="__codelineno-1-70" href="#__codelineno-1-70"></a><span class="w">    </span><span class="c1">// register for ATT event</span>
<a id="__codelineno-1-71" name="__codelineno-1-71" href="#__codelineno-1-71"></a><span class="w">    </span><span class="n">att_server_register_packet_handler</span><span class="p">(</span><span class="n">packet_handler</span><span class="p">);</span>
<a id="__codelineno-1-72" name="__codelineno-1-72" href="#__codelineno-1-72"></a>
<a id="__codelineno-1-73" name="__codelineno-1-73" href="#__codelineno-1-73"></a><span class="w">    </span><span class="c1">// set one-shot btstack timer</span>
<a id="__codelineno-1-74" name="__codelineno-1-74" href="#__codelineno-1-74"></a><span class="w">    </span><span class="n">heartbeat</span><span class="p">.</span><span class="n">process</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">heartbeat_handler</span><span class="p">;</span>
<a id="__codelineno-1-75" name="__codelineno-1-75" href="#__codelineno-1-75"></a><span class="w">    </span><span class="n">btstack_run_loop_set_timer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">heartbeat</span><span class="p">,</span><span class="w"> </span><span class="n">HEARTBEAT_PERIOD_MS</span><span class="p">);</span>
<a id="__codelineno-1-76" name="__codelineno-1-76" href="#__codelineno-1-76"></a><span class="w">    </span><span class="n">btstack_run_loop_add_timer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">heartbeat</span><span class="p">);</span>
<a id="__codelineno-1-77" name="__codelineno-1-77" href="#__codelineno-1-77"></a>
<a id="__codelineno-1-78" name="__codelineno-1-78" href="#__codelineno-1-78"></a><span class="w">    </span><span class="c1">// turn on bluetooth!</span>
<a id="__codelineno-1-79" name="__codelineno-1-79" href="#__codelineno-1-79"></a><span class="w">    </span><span class="n">hci_power_control</span><span class="p">(</span><span class="n">HCI_POWER_ON</span><span class="p">);</span>
<a id="__codelineno-1-80" name="__codelineno-1-80" href="#__codelineno-1-80"></a>
<a id="__codelineno-1-81" name="__codelineno-1-81" href="#__codelineno-1-81"></a><span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-82" name="__codelineno-1-82" href="#__codelineno-1-82"></a><span class="w">        </span><span class="n">tight_loop_contents</span><span class="p">();</span>
<a id="__codelineno-1-83" name="__codelineno-1-83" href="#__codelineno-1-83"></a>
<a id="__codelineno-1-84" name="__codelineno-1-84" href="#__codelineno-1-84"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-85" name="__codelineno-1-85" href="#__codelineno-1-85"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-1-86" name="__codelineno-1-86" href="#__codelineno-1-86"></a><span class="p">}</span>
</code></pre></div>
</details>
<p>Agora no arquivo <code>server_common.c</code> edite em <code>adv_data</code> o campo <code>BLUETOOTH_DATA_TYPE_COMPLETE_LOCAL_NAME</code>, troque para um nome seu personalizado:</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Note que o primeiro argumento é referente a quantidade de caractere, esse valor em hexadecimal você deve ajustar conforme o nome desejado.</p>
<p>O Attribute Protocol (ATT) define a maneira como os dados são organizados, acessados e manipulados em dispositivos BLE. Ele estrutura os dados em "atributos", que são unidades básicas de dados identificadas por identificadores únicos (handles). Esses atributos podem representar várias coisas, como valores de sensores, estados de dispositivos ou configurações.</p>
<p>Atributos são unidades básicas de dados identificadas por um identificador único (handle). Cada atributo tem um tipo e um valor. Para saber mais consulte:</p>
<ul>
<li><a href="https://github.com/bluekitchen/btstack/blob/master/src/bluetooth_data_types.h">https://github.com/bluekitchen/btstack/blob/master/src/bluetooth_data_types.h</a></li>
</ul>
</div>
<div class="language-C highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">static</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">adv_data</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="c1">// Flags general discoverable</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="mh">0x02</span><span class="p">,</span><span class="w"> </span><span class="n">BLUETOOTH_DATA_TYPE_FLAGS</span><span class="p">,</span><span class="w"> </span><span class="n">APP_AD_FLAGS</span><span class="p">,</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="c1">// Name</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">    </span><span class="mh">0x17</span><span class="p">,</span><span class="w"> </span><span class="n">BLUETOOTH_DATA_TYPE_COMPLETE_LOCAL_NAME</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;P&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;i&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;c&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;o&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39; &#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;:&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;:&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;:&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;:&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;:&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">,</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">    </span><span class="mh">0x03</span><span class="p">,</span><span class="w"> </span><span class="n">BLUETOOTH_DATA_TYPE_COMPLETE_LIST_OF_16_BIT_SERVICE_CLASS_UUIDS</span><span class="p">,</span><span class="w"> </span><span class="mh">0x1a</span><span class="p">,</span><span class="w"> </span><span class="mh">0x18</span><span class="p">,</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="p">};</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">adv_data_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">adv_data</span><span class="p">);</span>
</code></pre></div>
<p>Compile e rode o código em sua placa. </p>
<h3 id="para-receber-os-anuncios-em-outros-dispositivos">Para receber os anuncios em outros dispositivos</h3>
<p>1) Receba pelo celular, para isso faça:</p>
<ul>
<li>Instalar no telefone celular o aplicativo <code>Nordic nRF Connect</code>.</li>
<li>Verifica os BLE próximos </li>
<li>Exibir os dados recebidos.</li>
</ul>
<h2 id="entrega">Entrega</h2>
<p>A ideia da entrega vai ser transmitir as informações não mais entre a PICO e um celular, mas sim entre duas PICOS. Uma das PICOs vai se comportar como device, coletando dados do ADC e enviando via bluetooth, e a outra pico vai servir como host, recebendo o dado e exibindo no OLED. </p>
<p>No lugar do sensor de temperatura, vamos conectar um sensor de potenciômetro. </p>
<p>Para receber o dado pela outra placa pico W será necessário: </p>
<ul>
<li>Você vai precisar de uma segunda placa pico W</li>
<li>Use como base o código <a href="https://github.com/raspberrypi/pico-examples/blob/master/pico_w/bt/standalone/client.c">client.c</a>.</li>
<li>Faça os ajustes necessários, para que o valor seja exibido no display oled. </li>
</ul>
<h2 id="referencias">Referências:</h2>
<p><a href="https://www.bluetooth.com/specifications/assigned-numbers/">https://www.bluetooth.com/specifications/assigned-numbers/</a></p>
<p><a href="https://www.bluetooth.com/specifications/specs/hid-over-gatt-profile-1-0/">https://www.bluetooth.com/specifications/specs/hid-over-gatt-profile-1-0/</a></p>
<p><a href="https://www.bluetooth.com/wp-content/uploads/Files/Specification/HTML/CSS_v11/out/en/supplement-to-the-bluetooth-core-specification/data-types-specification.html">https://www.bluetooth.com/wp-content/uploads/Files/Specification/HTML/CSS_v11/out/en/supplement-to-the-bluetooth-core-specification/data-types-specification.html</a></p>
<p><a href="https://github.com/bluekitchen/btstack/tree/master/example">https://github.com/bluekitchen/btstack/tree/master/example</a></p>
<p><a href="https://bluekitchen-gmbh.com/">https://bluekitchen-gmbh.com/</a></p>


</section>
          
        
      </main>
      <footer class="ah-footer ah-typeset">
        <div class="ah-footer-nav">
          
          
        </div>
      </footer>
    </div>
    
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script src="../../termynal.js"></script>
    
  <script>const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});</script></body>
</html>