<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
      
        <title>DMA - Computação Embarcada - 2.0</title>
      
    
    <link rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Fira+Sans+Extra+Condensed:700|Oxygen+Mono|Source+Sans+Pro:700|Source+Serif+Pro&amp;display=swap">
    <link rel="stylesheet" href="../../assets/css/main.css">
    <script>
      // SETUP GLOBAL CONSTANTS
      var base_url = '../..';
      
      var telemetryEnabled = false;
      var backendUrl = "";
      var courseSlug = "";
      
      
      var dashboardEnabled = true;
      var tagTree = [{'reference': ['choice-exercise', 'parsons-exercise', 'text-exercise']}, {'grandparent-tag': [{'parent-tag': ['child-tag']}]}];
      

      // SETUP PLUGIN
      window.initialized = false;
      if (!window.initializers) window.initializers = [];
      window.registerInitializer = (initialize) => {
        if (window.initialized) initialize();
        else window.initializers.push(initialize);
      };
    </script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          processEscapes: true
        }
      });
    </script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="https://unpkg.com/hyperscript.org"></script>
    <script src="https://unpkg.com/htmx.org@1.8.4"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="../../assets/js/main.js"></script>
    
    <link rel="stylesheet" href="../../termynal.css">
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  <body>
    <div class="ah-main-container">
      <header class="ah-header">
        <button class="ah-menu-btn ah-button ah-button--borderless"
                aria-label="toggle menu">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
  <!--! Font Awesome Pro 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
  <path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/>
</svg>
        </button>
        <a href="../.."
           title="Computação Embarcada - 2.0"
           class="ah-logo"
           aria-label="Computação Embarcada - 2.0">
          Computação Embarcada - 2.0
        </a>
        <div class="ah-header--right">
          
          
          
          <button id="resetHandoutButton">
            <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-trash3" viewBox="0 0 16 16">
  <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"/>
</svg></span>
          </button>
          

          
        </div>
      </header>
      <nav class="ah-navigation preload">
        <div class="ah-nav-container">
          <button class="ah-menu-btn ah-button ah-button--borderless close-menu"
                  aria-label="close menu">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">
  <!--! Font Awesome Pro 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
  <path d="M310.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L160 210.7 54.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L114.7 256 9.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 301.3 265.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L205.3 256 310.6 150.6z"/>
</svg>
          </button>
          <ul class="ah-nav-body">
            
              
  
    <li>
      <a href="../..">Home</a>
    </li>
  

            
              
  
    <li>
      <a href="../../aulas/">Aulas</a>
    </li>
  

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Avaliação</span>
    <ul>
      
        
  
    <li>
      <a href="../../avaliacao/">Critério</a>
    </li>
  

      
        
  
    <li>
      <a href="../../simulados/">Prática</a>
    </li>
  

      
    </ul>
  </li>

            
              
  
    <li>
      <a href="../../infra-2.0/">Infra</a>
    </li>
  

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Prototipando</span>
    <ul>
      
        
  
    <li>
      <a href="../../prototipos/prototipos/">Fabricação</a>
    </li>
  

      
        
  
    <li>
      <a href="../../prototipos/entradas/">Entradas</a>
    </li>
  

      
        
  
    <li>
      <a href="../../prototipos/saida.md">Saídas</a>
    </li>
  

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Utils</span>
    <ul>
      
        
  
    <li>
      <a href="../../utils/utils-uinput/">Uinput</a>
    </li>
  

      
        
  
    <li>
      <a href="../../utils/utils-pyautogui/">pyautogui</a>
    </li>
  

      
        
  
    <li>
      <a href="../../utils/utils-vjoy/">vjoy</a>
    </li>
  

      
        
  
    <li>
      <a href="../../utils/utils-volume/">Volume</a>
    </li>
  

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Dispositivos</span>
    <ul>
      
        
  
    <li>
      <a href="../../dispositivos/alimentacao_externa/">Alimentação Externa</a>
    </li>
  

      
        
  
    <li>
      <a href="../../dispositivos/analogicos/">Análogicos</a>
    </li>
  

      
        
  
    <li>
      <a href="../../dispositivos/buzzer/">Buzzer</a>
    </li>
  

      
        
  
    <li>
      <a href="../../dispositivos/cd4051/">CD4051</a>
    </li>
  

      
        
  
    <li>
      <a href="../../dispositivos/hc06/">HC-06 (Bluetooth)</a>
    </li>
  

      
        
  
    <li>
      <a href="https://perrobotica.fandom.com/pt-br/wiki/Sensor_de_dist%C3%A2ncia_Hcsr04">HC-SR04 (Ultrassom)</a>
    </li>
  

      
        
  
    <li>
      <a href="../../dispositivos/oled1/">OLED1</a>
    </li>
  

      
        
  
    <li>
      <a href="../../dispositivos/servo/">Servomotor</a>
    </li>
  

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Pico W</span>
    <ul>
      
        
  
    <li>
      <a href="https://datasheets.raspberrypi.com/picow/pico-w-datasheet.pdf">Datasheet</a>
    </li>
  

      
        
  
    <li>
      <a href="https://www.raspberrypi.com/documentation/microcontrollers/images/picow-pinout.svg">Hardware</a>
    </li>
  

      
        
  
    <li>
      <a href="../../pico/pico-examples/">pico-examples</a>
    </li>
  

      
        
  
    <li>
      <a href="../../pico/pico-debugging/">Programando</a>
    </li>
  

      
        
  
    <li>
      <a href="../../pico/pico-wifi/">WIFI</a>
    </li>
  

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item opened">
    <span class="ah-togglable-handle">RP2040</span>
    <ul>
      
        
  
    <li>
      <a href="https://datasheets.raspberrypi.com/rp2040/rp2040-datasheet.pdf">Datasheet</a>
    </li>
  

      
        
  
    <li>
      <a href="https://www.raspberrypi.com/documentation/pico-sdk/index_doxygen.html">SDK</a>
    </li>
  

      
        
  
    <li>
      <a href="../rp2040-delay/">Delay</a>
    </li>
  

      
        
  
    <li>
      <a href="../rp2040-gpio/">GPIO</a>
    </li>
  

      
        
  
    <li>
      <a href="../rp2040-gpio-irq/">GPIO IRQ</a>
    </li>
  

      
        
  
    <li>
      <a href="../rp2040-timer/">Timer</a>
    </li>
  

      
        
  
    <li>
      <a href="../rp2040-rtc/">RTC</a>
    </li>
  

      
        
  
    <li>
      <a href="https://kevinboone.me/picoflash.html">Flash</a>
    </li>
  

      
        
  
    <li>
      <a href="../rp2040-adc/">ADC</a>
    </li>
  

      
        
  
    <li>
      <a href="../rp2040-pwm/">PWM</a>
    </li>
  

      
        
  
    <li>
      <a href="../rp2040-i2c/">I2C</a>
    </li>
  

      
        
  

    <li class="active ah-togglable-item opened">
      <span class="ah-togglable-handle">DMA</span>
      <ul>
        
          
            
            
              <li class="ah-toc-item">
                <a href="#introducao-ao-dma">Introdução ao DMA:</a>
              </li>
            
              <li class="ah-toc-item">
                <a href="#aplicacoes-praticas">Aplicações Práticas:</a>
              </li>
            
              <li class="ah-toc-item">
                <a href="#vantagens-do-dma">Vantagens do DMA:</a>
              </li>
            
              <li class="ah-toc-item">
                <a href="#desvantagens-do-dma">Desvantagens do DMA:</a>
              </li>
            
              <li class="ah-toc-item">
                <a href="#rp2040-pico">RP2040 / PICO</a>
              </li>
            
              <li class="ah-toc-item">
                <a href="#sdk-e-praticando">SDK e Praticando</a>
              </li>
            
              <li class="ah-toc-item">
                <a href="#desvendando-o-codigo-hello_dmac">Desvendando o código: hello_dma.c</a>
              </li>
            
              <li class="ah-toc-item">
                <a href="#referencias">Referências:</a>
              </li>
            
        
      </ul>
    </li>
  

      
        
  
    <li>
      <a href="../rp2040-uart/">UART</a>
    </li>
  

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">FreeRTOS</span>
    <ul>
      
        
  
    <li>
      <a href="../../freertos/freertos-basic/">RTOS</a>
    </li>
  

      
        
  
    <li>
      <a href="../../freertos/freertos-tasks/">Tasks</a>
    </li>
  

      
        
  
    <li>
      <a href="../../freertos/freertos-vtaskDelay/">VtaskDelay</a>
    </li>
  

      
        
  
    <li>
      <a href="../../freertos/freertos-software-time/">Software Timer</a>
    </li>
  

      
        
  
    <li>
      <a href="../../freertos/freertos-semaphore/">Semaphore</a>
    </li>
  

      
        
  
    <li>
      <a href="../../freertos/freertos-queue/">Queue</a>
    </li>
  

      
        
  
    <li>
      <a href="../../freertos/freertos-queue-advanced/">Queue struct</a>
    </li>
  

      
        
  
    <li>
      <a href="../../freertos/freertos-smp/">SMP</a>
    </li>
  

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Code quality</span>
    <ul>
      
        
  
    <li>
      <a href="../../CodeQuality/topview/">Visão geral</a>
    </li>
  

      
        
  
    <li>
      <a href="../../CodeQuality/rules/">Regras</a>
    </li>
  

      
        
  
    <li>
      <a href="../../CodeQuality/cppcheck/">Cppcheck</a>
    </li>
  

      
        
  
    <li>
      <a href="../../CodeQuality/variables/">Variáveis</a>
    </li>
  

      
        
  
    <li>
      <a href="../../CodeQuality/isr-variables/">ISR - variáveis</a>
    </li>
  

      
        
  
    <li>
      <a href="../../CodeQuality/isr-handler/">ISR - handler</a>
    </li>
  

      
        
  
    <li>
      <a href="../../CodeQuality/head-file/">Head File</a>
    </li>
  

      
        
  
    <li>
      <a href="../../CodeQuality/rtos/">RTOS</a>
    </li>
  

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Labs core</span>
    <ul>
      
        
  
    <li>
      <a href="../../labs/pre-lab/">Preparatórios</a>
    </li>
  

      
        
  
    <li>
      <a href="../../labs/pra-lab/">Prática</a>
    </li>
  

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">GPIO</span>
    <ul>
      
        
  
    <li>
      <a href="https://app.mural.co/t/elementos9119/m/elementos9119/1708285630708/f7182e10dd73d346d8a1e216545399fffbf036f4?sender=ub569a9273c6e285461187641">Apresentação</a>
    </li>
  

      
        
  
    <li>
      <a href="../../labs/qualidade-codigo-1">⏰ Qualidade de Código</a>
    </li>
  

      
        
  
    <li>
      <a href="../../labs/gpio-pre-lab/">⏰ Preparatório</a>
    </li>
  

      
        
  
    <li>
      <a href="../../labs/gpio-pra-lab/">Prática</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">ISR</span>
    <ul>
      
        
  
    <li>
      <a href="../../labs/qualidade-codigo-irs">⏰ Qualidade de Código</a>
    </li>
  

      
        
  
    <li>
      <a href="../../labs/irq-pre-lab/">⏰ Preparatório</a>
    </li>
  

      
        
  
    <li>
      <a href="../../labs/irq-pra-lab/">Prática</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Timer</span>
    <ul>
      
        
  
    <li>
      <a href="../../CodeQuality/head-file/">Head File</a>
    </li>
  

      
        
  
    <li>
      <a href="../../labs/timer-pre-lab/">⏰ Preparatório</a>
    </li>
  

      
        
  
    <li>
      <a href="../../labs/timer-pra-lab/">Prática</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">RTOS</span>
    <ul>
      
        
  
    <li>
      <a href="../../labs/rtos-pre-lab/">⏰ Preparatório</a>
    </li>
  

      
        
  
    <li>
      <a href="../../labs/rtos-pra-lab/">Prática</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">ADC/PWM</span>
    <ul>
      
        
  
    <li>
      <a href="../../labs/adc-pwm-pre-lab/">⏰ Preparatório</a>
    </li>
  

      
        
  
    <li>
      <a href="../../labs/adc-pwm-pra-lab/">Prática</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">I2C</span>
    <ul>
      
        
  
    <li>
      <a href="../../labs/i2c-pre-lab/">⏰ Preparatório</a>
    </li>
  

      
        
  
    <li>
      <a href="../../labs/i2c-pra-lab/">Prática</a>
    </li>
  

      
    </ul>
  </li>

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">APS</span>
    <ul>
      
        
  
    <li>
      <a href="../../aps/aps-1-genius/">Aps 1 genius</a>
    </li>
  

      
        
  
    <li>
      <a href="../../aps/aps-2-controle/">Aps 2 controle</a>
    </li>
  

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Labs experts</span>
    <ul>
      
        
  
    <li>
      <a href="../../labs-expert/labs-expert-about/">Sobre</a>
    </li>
  

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Comunicação</span>
    <ul>
      
        
  
    <li>
      <a href="../../labs-expert/labs-expert-com-wifi-mqtt/">WIFI</a>
    </li>
  

      
        
  
    <li>
      <a href="../../labs-expert/labs-expert-com-bt/">Bluetooth</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">DSP</span>
    <ul>
      
        
  
    <li>
      <a href="../../labs-expert/labs-expert-dsp-audio/">Áudio</a>
    </li>
  

      
        
  
    <li>
      <a href="../../labs-expert/labs-expert-dsp-ia/">IA</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Sensores/Atuadores</span>
    <ul>
      
        
  
    <li>
      <a href="../../labs-expert/labs-expert-sensors-servomotor/">Servomotor</a>
    </li>
  

      
        
  
    <li>
      <a href="../../labs-expert/labs-expert-sensors-bme280-ili9341/">LCD / BME280</a>
    </li>
  

      
    </ul>
  </li>

      
        
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Firmware</span>
    <ul>
      
        
  
    <li>
      <a href="../../labs-expert/labs-expert-firmware-driver/">Driver</a>
    </li>
  

      
        
  
    <li>
      <a href="../../labs-expert/labs-expert-firmware-dma/">DMA</a>
    </li>
  

      
    </ul>
  </li>

      
    </ul>
  </li>

            
              
  <li class="ah-togglable-item">
    <span class="ah-togglable-handle">Projeto</span>
    <ul>
      
        
  
    <li>
      <a href="../../projeto/">Sobre</a>
    </li>
  

      
        
  
    <li>
      <a href="../../projeto/rubrica/">Rubrica</a>
    </li>
  

      
        
  
    <li>
      <a href="../../projeto/entrega-1/">Entrega</a>
    </li>
  

      
    </ul>
  </li>

            
          </ul>
        </div>
      </nav>
      <main class="ah-content ah-typeset">
        
          <div class="ah-title-box">
            <ul class="ah-breadcrumbs">
              
                
                  
                    <li>RP2040</li>
                  
                
                <li></li>
            </ul>
            
            
          </div>
          
            <section class="progress-section show">
<h1 id="dma">DMA</h1>
<h3 id="introducao-ao-dma">Introdução ao DMA:</h3>
<p>DMA (Direct Memory Access) é um controlador especializado em transferir dados, com ele conseguimos transferir dados entre periféricos e memórias de computadores sem depender da CPU, o que acaba trazendo diversos benefícios para sistemas computacionais e também para aplicações de soluções embarcadas. </p>
<h3 id="aplicacoes-praticas">Aplicações Práticas:</h3>
<ul>
<li>placas de rede, </li>
<li>controladores de disco, </li>
<li>interfaces de áudio e vídeo, </li>
<li>entre outros.</li>
</ul>
<details>
<summary>Expanda se quiser saber sobre a história do DMA</summary>

O DMA não é uma coisa nova...<br><br>

- Foi introduzido inicialmente em computadores de mainframe entre os anos de 1950 - 1970. Inicialmente era um simples bloco com mecanismo para mover dados entre um dispositivo e uma memória.<br>

- Nos anos 80, dado a comercialização de computadores pessoais, o DMA tornou-se mais e mais comum em sistemas com periféricos, tal como drivers de memória.<br>

- Nos anos 90, com alta nas aplicações na área de multimídia e internet, surgiram demandas por taxas de transferência de dados mais rápidas. Assim o DMA foi introduzido com foco em otimizar a transferência de dados e reduzir a latência.<br>

- Nos anos 2000, avanços na arquitetura envolvendo os barramentos do computador, tais como o surgimento de tecnologias como o PCI e PCIe, ocasionaram uma melhor comunicação entre dispositivos e a CPU.<br>

- No ano de 2010, dado a emergência de computação paralela e processadores multi-core, os controladores DMA foram otimizados para processamento multi-threading.<br>

- Entre 2010 e 2020, com o destaque do IoT (Internet of Things) e sistemas embarcados, os controladores DMA foram adotados como requisito para sistemas de baixo consumo.
</details>

<h3 id="vantagens-do-dma">Vantagens do DMA:</h3>
<ul>
<li>
<p>Velocidade de transferência de dados mais rápida que na CPU.</p>
</li>
<li>
<p>Reduz o trabalho da CPU, deixando ela disponível para focar em outras tarefas.</p>
</li>
<li>
<p>Múltiplos canais DMA trabalham simultaneamente o que melhora a performance do sistema em termos de fluxo de dados.</p>
</li>
</ul>
<p>O controlador DMA pode reduzir o consumo de energia, permitindo que a CPU permaneça em modo de baixo consumo até que haja uma interrupção externa por parte de algum periférico.</p>
<h3 id="desvantagens-do-dma">Desvantagens do DMA:</h3>
<ul>
<li>
<p>Configurações de DMA não são sempre compatíveis entre diferentes hardwares.</p>
</li>
<li>
<p>Dificuldades quando estamos escrevendo numa memória que contém tanto a fonte como o destino dos dados.</p>
</li>
<li>
<p>Como a DMA toma conta do barramento de memória para transferência de dados, às vezes a CPU tem que esperar o controlador DMA completar sua tarefa.</p>
</li>
<li>
<p>Em alguns dos dispositivos pode haver conflito de memória quando múltiplos dispositivos tentarem usar o DMA simultaneamente.</p>
</li>
</ul>
<h2 id="rp2040-pico">RP2040 / PICO</h2>
<p>O nosso microcontrolador RP2040 é equipado com um poderoso DMA, o qual pode realizar um acesso de leitura e escrita com até 32 bits de tamanho a cada clock do sistema.</p>
<h3 id="cenarios-comuns-em-que-se-utiliza-o-dma">Cenários comuns em que se utiliza o DMA:</h3>
<p>Abaixo há a descrição do fluxo de dados utilizando o controlador DMA e também uma imagem deste mesmo fluxo no nosso microcontrolador RP2040 para ilustrar o conceito.</p>
<ul>
<li>Memória para periférico: Um periférico sinaliza ao DMA quando precisa enviar mais dados. O DMA lê os dados de um array da RAM ou flash, e escreve no periférico utilizando o método FIFO (First In, First Out).</li>
</ul>
<p><a class="glightbox" href="../imgs/dma-memtoper.gif" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="rp2040-dma" src="../imgs/dma-memtoper.gif" /></a></p>
<ul>
<li>Periférico para memória: Neste modo, o periférico manda um sinal para o DMA quando os dados são recebidos. O DMA lê os dados do periférico por meio do método FIFO, e então escreve os mesmos em um array na RAM do microcontrolador.</li>
</ul>
<p><a class="glightbox" href="../imgs/dma-pertomem.gif" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="rp2040-dma" src="../imgs/dma-pertomem.gif" /></a></p>
<ul>
<li>Memória para memória: O DMA transfere dados entre dois buffers na RAM.</li>
</ul>
<p><a class="glightbox" href="../imgs/dma-memtomem.gif" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="rp2040-dma" src="../imgs/dma-memtomem.gif" /></a></p>
<h3 id="componentes-envolvidos">Componentes Envolvidos:</h3>
<p>Analisando a estrutura do nosso microcontrolador RP2040 na Figura 1, observamos que o DMA está conectado diretamente ao Bus Fabric, cuja função é fazer a comunicação entre os componentes da RP2040.</p>
<p>Figura 1 - Arquitetura do RP2040</p>
<p><a class="glightbox" href="../imgs/rp2040-arch.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="rp2040-arch" src="../imgs/rp2040-arch.png" title="Figura 1" /></a></p>
<h3 id="o-que-e-o-bus-fabric">O que é o "Bus Fabric"?</h3>
<p>Na figura 2, vocês podem ver os componentes do Bus Fabric da RP2040 em amarelo e com quais partes do nosso microcontrolador ele se interliga, repare que o DMA está representado no canto superior direito. O Bus Fabric serve para interligar endereços e transportar dados através do chip. AHB-lite Crossbar é um barramento que trabalha com um protocolo AHB-lite (AMBA 3 AHB-lite), o qual o Bus Fabric faz uso. O DMA utiliza os barramentos do Bus Fabric para transmitir dados.</p>
<p>Figura 2 - RP2040 Bus Fabric</p>
<p><a class="glightbox" href="../imgs/rp2040-bus-fabric.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="rp2040-bus-fabric" src="../imgs/rp2040-bus-fabric.png" title="Figura 2" /></a></p>
<p>Abaixo, na figura 3, é possível observar a estrutura interna do DMA. O mesmo possui conexões separadas de leitura e escrita que são ligadas diretamente ao Bus Fabric, e realizam a transferência de dados. <strong>A taxa de transferência de dados através de um DMA é superior ao que um dos processadores do RP2040 conseguiria realizar</strong>.</p>
<ul>
<li>
<p>As conexões de leitura e escrita são ligadas diretamente ao Bus Fabric, através do AHB-lite Read Master e AHB-lite Write Master.</p>
</li>
<li>
<p>Internamente no DMA é processado o endereço de origem e destino dos dados.</p>
</li>
<li>
<p>Para controle e verificação do status das transferências de dados com o DMA é necessário manipular seus registradores específicos para cada ação. Caso queira saber mais sobre os registradores do DMA, acesse: <a href="https://datasheets.raspberrypi.com/rp2040/rp2040-datasheet.pdf#page=103">DMA Registers</a></p>
</li>
</ul>
<p>Figura 3 - DMA</p>
<p><a class="glightbox" href="../imgs/dma_intern.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="dma_intern" src="../imgs/dma_intern.png" title="Figura 3" /></a></p>
<h3 id="modos-de-operacao-do-dma-utilizando-a-rp2040">Modos de Operação do DMA utilizando a RP2040:</h3>
<p>O DMA pode operar como leitura e escrita, sendo que na RP2040 o limite de leitura e escrita do DMA é um array de até 32 bits de comprimento a cada ciclo de clock. Há 12 canais independentes na RP2040, cada um deles verificando uma sequência de transferência de dados.
Cada um dos 12 canais tem seu pŕoprio registrador de controle e status, no qual o sofware pode programar e monitorar o progresso da transferência de dados dos canais. Quando vários canais estão ativos ao mesmo tempo, o DMA divide a largura de banda igualmente entre os canais.</p>
<p>O tamanho de transferência pode ser 32, 16 ou 8 bits, e necessita ser configurado apenas uma vez por canal.</p>
<h2 id="sdk-e-praticando">SDK e Praticando</h2>
<p>Para usar o DMA você deve modificar o <code>CMakeLists.txt</code> adicionando <code>hardware_dma</code> no <code>target_link_libraries</code>:</p>
<div class="language-diff highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>target_link_libraries(
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w"> </span>                     ....
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w"> </span>                     .....
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gi">+                     hardware_dma)</span>
</code></pre></div>
<p>E adicionar no headfile:</p>
<div class="language-c highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;hardware/dma.h&quot;</span>
</code></pre></div>
<p>Para treinar o uso do DMA, vamos fazer um pouco diferente desta vez:</p>
<ol>
<li>
<p>Rode o código <strong>hello_dma.c</strong> da seção <strong>Snippets</strong>.</p>
</li>
<li>
<p>Reserve um tempo para tentar entendê-lo.</p>
</li>
<li>
<p>Por final leia a seção <strong>Desvendando o código: hello_dma.c</strong>.</p>
</li>
</ol>
<h3 id="snippets">Snippets</h3>
<p>Códigos de exemplo para o DMA.</p>
<h3 id="hello-dma">Hello DMA</h3>
<p><a class="ah-button" href="/definir/link">Simulação no wokwi</a>
/
<a class="ah-button" href="https://github.com/raspberrypi/pico-examples/blob/master/dma/hello_dma/hello_dma.c">pico-examples/dma/hello_dma/hello_dma.c</a></p>
<div class="language-c highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1">// Use the DMA to copy data between two buffers in memory.</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;pico/stdlib.h&quot;</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;hardware/dma.h&quot;</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="c1">// Data will be copied from src to dst</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">src</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hello, world! (from DMA)&quot;</span><span class="p">;</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="kt">char</span><span class="w"> </span><span class="n">dst</span><span class="p">[</span><span class="n">count_of</span><span class="p">(</span><span class="n">src</span><span class="p">)];</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">    </span><span class="n">stdio_init_all</span><span class="p">();</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">    </span><span class="c1">// Get a free channel, panic() if there are none</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">chan</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dma_claim_unused_channel</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="w">    </span><span class="c1">// 8 bit transfers. Both read and write address increment after each</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="w">    </span><span class="c1">// transfer (each pointing to a location in src or dst respectively).</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="w">    </span><span class="c1">// No DREQ is selected, so the DMA transfers as fast as it can.</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="w">    </span><span class="n">dma_channel_config</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dma_channel_get_default_config</span><span class="p">(</span><span class="n">chan</span><span class="p">);</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="w">    </span><span class="n">channel_config_set_transfer_data_size</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">DMA_SIZE_8</span><span class="p">);</span>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="w">    </span><span class="n">channel_config_set_read_increment</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="w">    </span><span class="n">channel_config_set_write_increment</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a><span class="w">    </span><span class="n">dma_channel_configure</span><span class="p">(</span>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a><span class="w">        </span><span class="n">chan</span><span class="p">,</span><span class="w">          </span><span class="c1">// Channel to be configured</span>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a><span class="w">        </span><span class="o">&amp;</span><span class="n">c</span><span class="p">,</span><span class="w">            </span><span class="c1">// The configuration we just created</span>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a><span class="w">        </span><span class="n">dst</span><span class="p">,</span><span class="w">           </span><span class="c1">// The initial write address</span>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a><span class="w">        </span><span class="n">src</span><span class="p">,</span><span class="w">           </span><span class="c1">// The initial read address</span>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a><span class="w">        </span><span class="n">count_of</span><span class="p">(</span><span class="n">src</span><span class="p">),</span><span class="w"> </span><span class="c1">// Number of transfers; in this case each is 1 byte.</span>
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a><span class="w">        </span><span class="nb">true</span><span class="w">           </span><span class="c1">// Start immediately.</span>
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a><span class="w">    </span><span class="p">);</span>
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a>
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a><span class="w">    </span><span class="c1">// We could choose to go and do something else whilst the DMA is doing its</span>
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a><span class="w">    </span><span class="c1">// thing. In this case the processor has nothing else to do, so we just</span>
<a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a><span class="w">    </span><span class="c1">// wait for the DMA to finish.</span>
<a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a><span class="w">    </span><span class="n">dma_channel_wait_for_finish_blocking</span><span class="p">(</span><span class="n">chan</span><span class="p">);</span>
<a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a>
<a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a><span class="w">    </span><span class="c1">// The DMA has now copied our text from the transmit buffer (src) to the</span>
<a id="__codelineno-2-41" name="__codelineno-2-41" href="#__codelineno-2-41"></a><span class="w">    </span><span class="c1">// receive buffer (dst), so we can print it out from there.</span>
<a id="__codelineno-2-42" name="__codelineno-2-42" href="#__codelineno-2-42"></a><span class="w">    </span><span class="n">puts</span><span class="p">(</span><span class="n">dst</span><span class="p">);</span>
<a id="__codelineno-2-43" name="__codelineno-2-43" href="#__codelineno-2-43"></a><span class="p">}</span>
</code></pre></div>
<h2 id="desvendando-o-codigo-hello_dmac">Desvendando o código: hello_dma.c</h2>
<p><strong>Propósito do programa:</strong> Enviar dados de um array src[] para outro array dst[] através do uso do controlador DMA do microcontrolador RP2040.</p>
<ul>
<li><strong>Importando tudo</strong></li>
</ul>
<div class="language-c highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="w">    </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;hardware/dma.h&quot;</span>
</code></pre></div>
<p>Nesta primeira etapa importamos bibliotecas que faremos uso no nosso código. Como iremos utilizar o <strong>DMA</strong>, precisamos importar a biblioteca <strong>hardware/dma.h</strong> e outras bibliotecas necessárias.</p>
<ul>
<li><strong>Escolhendo a mensagem</strong></li>
</ul>
<div class="language-c highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">src</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hello, world! (from DMA)&quot;</span><span class="p">;</span>
</code></pre></div>
<p>Alocamos a mensagem a ser transmitida via DMA em um array de caracteres com nome <strong>src[]</strong>.</p>
<ul>
<li><strong>Definindo a origem e os destinos da mensagem</strong></li>
</ul>
<div class="language-c highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">dst</span><span class="p">[</span><span class="n">count_of</span><span class="p">(</span><span class="n">src</span><span class="p">)];</span>
</code></pre></div>
<p>Cria um array com nome <strong>dst[]</strong> com o tamanho da mensagem em <strong>src[]</strong>, que no caso são 24 caracteres mais o caractere nulo, totalizando 25 caracteres, conforme mostrado na figura 4. <strong>dst[]</strong> será o array de destino, por isso estamos criando ele com o mesmo tamanho do array de origem (<strong>src[]</strong>).</p>
<p>Figura 4 - Conteúdo do array src[]</p>
<p><a class="glightbox" href="../imgs/dma-hello-dma-src.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="dma_intern" src="../imgs/dma-hello-dma-src.png" /></a></p>
<ul>
<li><strong>Adentrando o main(): Selecionando o canal</strong></li>
</ul>
<div class="language-c highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">chan</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dma_claim_unused_channel</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</code></pre></div>
<p>A função variável <strong>chan</strong>, que é uma abreviação de channel (canal em português), recebe um valor da <strong>dma_claim_unused_channel()</strong>, esta que serve para reinvindicar um canal DMA que esteja livre para uso, ou seja, dentre os 12 canais que temos disponíveis no nosso microcontrolador, iremos utilizar um deles que está livre.
- OBS: Se o parâmetro for <strong>true</strong> e não houver canais disponíveis, ocorrerá um erro.</p>
<ul>
<li><strong>Pré configurando o canal</strong></li>
</ul>
<div class="language-c highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="w">    </span><span class="n">dma_channel_config</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dma_channel_get_default_config</span><span class="p">(</span><span class="n">chan</span><span class="p">);</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span><span class="n">channel_config_set_transfer_data_size</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">DMA_SIZE_8</span><span class="p">);</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span><span class="n">channel_config_set_read_increment</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">    </span><span class="n">channel_config_set_write_increment</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
</code></pre></div>
<p>Vamos falar um pouco sobre a configuração de canais...</p>
<p>A função dma_channel_get_default_config(chan) configura um canal com uma configuração Default (padrão), na tabela 1 é possível observar como esta função configura cada um dos Settings do canal.</p>
<p>Tabela 1 - Parâmetros de configuração do canal</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>Read Increment</td>
<td>true</td>
</tr>
<tr>
<td>Write Increment</td>
<td>false</td>
</tr>
<tr>
<td>DReq</td>
<td>DREQ_FORCE</td>
</tr>
<tr>
<td>Chain to</td>
<td>self</td>
</tr>
<tr>
<td>Data size</td>
<td>DMA_SIZE_32</td>
</tr>
<tr>
<td>Ring</td>
<td>write false, size=0 (i.e. off)</td>
</tr>
<tr>
<td>Byte Swap</td>
<td>false</td>
</tr>
<tr>
<td>Quiet IRQs</td>
<td>false</td>
</tr>
<tr>
<td>High Priority</td>
<td>false</td>
</tr>
<tr>
<td>Channel Enable</td>
<td>true</td>
</tr>
<tr>
<td>Sniff Enable</td>
<td>false</td>
</tr>
</tbody>
</table>
<p><strong>Read Increment</strong>: Quando true, ele varia o endereço de leitura, após cada transferência o endereço de leitura muda, para que seja feita uma leitura continua utilizando vários endereços de memória. Se o objetivo for ler apenas um endereço de memória fixo, é necessário deixar Read Increment como false.</p>
<p><strong>Write Increment</strong>: Quando true ele segue a mesma lógica do Read Increment, porém ao invez de ele ler, ele escreve, e no caso escreverá em diversos endereços de memória de modo incremental, um após o outro, depois que cada escrita é realizada. Caso false, ele escreverá sempre no mesmo endereço de memória após o fim de cada transferência de dados.</p>
<h3 id="voltando-para-o-nosso-o-codigo">Voltando para o nosso o código...</h3>
<p>No final do trecho de código em questão, há a reconfiguração do canal <strong>c</strong> em relação aos seguintes parâmetros:</p>
<ul>
<li>
<p><strong>Data size</strong>, que é redefinido para 8 bits. </p>
</li>
<li>
<p><strong>Read Increment</strong>, que é redefinido para true (apesar de que por padrão ele já estava com <strong>true</strong>).</p>
</li>
<li>
<p><strong>Write Increment</strong>, que é redefinido para true.</p>
</li>
</ul>
<p><strong>Data  size</strong>: Seleciona qual a taxa de transferência, 1 byte, 1 halfword ou 1 word.</p>
<p>Para mais informações sobre a configuração de um canal: <a href="https://datasheets.raspberrypi.com/rp2040/rp2040-datasheet.pdf#page=114">RP2040 Datasheet</a></p>
<p><strong>Configurando o canal para transmissão</strong></p>
<p>A função dma_channel_configure() realiza a configuração de parâmetros do DMA e também pode começar a transferência logo após configurar, sendo esta última opcional.</p>
<div class="language-c highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">dma_channel_configure</span><span class="p">(</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">        </span><span class="n">chan</span><span class="p">,</span><span class="w">          </span><span class="c1">// Channel to be configured</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">        </span><span class="o">&amp;</span><span class="n">c</span><span class="p">,</span><span class="w">            </span><span class="c1">// The configuration we just created</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">        </span><span class="n">dst</span><span class="p">,</span><span class="w">           </span><span class="c1">// The initial write address</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">        </span><span class="n">src</span><span class="p">,</span><span class="w">           </span><span class="c1">// The initial read address</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">        </span><span class="n">count_of</span><span class="p">(</span><span class="n">src</span><span class="p">),</span><span class="w"> </span><span class="c1">// Number of transfers; in this case each is 1 byte.</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">        </span><span class="nb">true</span><span class="w">           </span><span class="c1">// Start immediately.</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">    </span><span class="p">);</span>
</code></pre></div>
<ol>
<li>
<p>O <strong>primeiro parâmetro</strong> é o canal que está sendo utilizado, neste caso do hello_dma.c é utilizado a variável chan, que é a variável que faz referência ao nosso canal que está sendo utilizado.</p>
</li>
<li>
<p>O <strong>segundo parâmetro</strong> são as configurações do canal, atrelados ao struct c, no caso criamos previamente as configurações e redefinimos parâmetros que foram necessários para nossa tarefa, tais como read increment, write, increment e data size.</p>
</li>
<li>
<p>O <strong>terceiro parâmetro</strong> define o endereço inicial de escrita, que no caso é o endereço da nossa variável dst (que remete a destiny, em português, destino).</p>
</li>
<li>
<p>O <strong>quarto parâmetro</strong> define o endereço inicial de leitura, que no caso é o endereço da nossa variável <strong>src[]</strong> (que remete a source, em português, origem).</p>
</li>
<li>
<p>O <strong>quinto parâmetro</strong> trata sobre o número de transferências necessárias para enviar os dados. No nosso caso, como estamos utilizando DMA_SIZE_8, podemos enviar 8 bits por cada transferência, 
e pensando que cada caractere precisa de no mínimo 8 bits para ser representado, teremos que fazer 25 transferências, 1 para cada caractere da nossa mensagem, por isso precisamos contar qual o valor do src em <strong>count_of(src)</strong>.</p>
</li>
<li>
<p>O <strong>sexto parâmetro</strong> define se o dma vai começar imediatamente a transmissão.</p>
</li>
</ol>
<p>Nesta parte do código a seguir, é definido que a prioridade é do DMA fazer a transferência dado que não precisamos fazer nada com o processador, então neste meio tempo o processador ficará esperando, sem fazer nada enquanto o DMA faz a transferência.</p>
<div class="language-c highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">dma_channel_wait_for_finish_blocking</span><span class="p">(</span><span class="n">chan</span><span class="p">);</span>
</code></pre></div>
<p><strong>Printando o valor do array de destino dos dados</strong></p>
<div class="language-c highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">puts</span><span class="p">(</span><span class="n">dst</span><span class="p">);</span>
</code></pre></div>
<p>Aqui printamos os valores que foram copiados para o array <strong>dst[]</strong> (destino). </p>
<h2 id="referencias">Referências:</h2>
<ul>
<li>
<p>"Understanding DMA." Hackaday. Disponível em: <a href="https://hackaday.com/2017/02/28/understanding-dma/">https://hackaday.com/2017/02/28/understanding-dma/</a></p>
</li>
<li>
<p>"Direct Memory Access: Basics and Its Applications." Revista de Innovación Sistemática, vol. 1, nº 2, p. 29. Disponível em: <a href="https://www.ecorfan.org/taiwan/research_journals/Innovacion_Sistematica/vol1num2/Revista_de_Innovacion_Sistem%C3%A1tica_V1_N2.pdf#page=29">https://www.ecorfan.org/taiwan/research_journals/Innovacion_Sistematica/vol1num2/Revista_de_Innovacion_Sistem%C3%A1tica_V1_N2.pdf#page=29</a></p>
</li>
<li>
<p>"Direct Memory Access (DMA)." Spiceworks. Disponível em: <a href="https://www.spiceworks.com/tech/hardware/articles/direct-memory-access/">https://www.spiceworks.com/tech/hardware/articles/direct-memory-access/</a></p>
</li>
<li>
<p>"Direct Memory Access (DMA)." GeeksforGeeks. Disponível em: <a href="https://www.geeksforgeeks.org/direct-memory-access/">https://www.geeksforgeeks.org/direct-memory-access/</a></p>
</li>
<li>
<p>Hackaday. "Understanding DMA." Disponível em: <a href="https://hackaday.com/2017/02/28/understanding-dma/">https://hackaday.com/2017/02/28/understanding-dma/</a></p>
</li>
<li>
<p>Revista de Innovación Sistemática. "Direct Memory Access: Basics and Its Applications." Vol. 1, nº 2, p. 29. Disponível em: <a href="https://www.ecorfan.org/taiwan/research_journals/Innovacion_Sistematica/vol1num2/Revista_de_Innovacion_Sistem%C3%A1tica_V1_N2.pdf#page=29">https://www.ecorfan.org/taiwan/research_journals/Innovacion_Sistematica/vol1num2/Revista_de_Innovacion_Sistem%C3%A1tica_V1_N2.pdf#page=29</a></p>
</li>
<li>
<p>Spiceworks. "Direct Memory Access (DMA)." Disponível em: <a href="https://www.spiceworks.com/tech/hardware/articles/direct-memory-access/">https://www.spiceworks.com/tech/hardware/articles/direct-memory-access/</a></p>
</li>
<li>
<p>GeeksforGeeks. "Direct Memory Access (DMA)." Disponível em: <a href="https://www.geeksforgeeks.org/direct-memory-access/">https://www.geeksforgeeks.org/direct-memory-access/</a></p>
</li>
<li>
<p>Spiceworks. "Direct Memory Access (DMA)." Disponível em: <a href="https://www.spiceworks.com/tech/hardware/articles/direct-memory-access/">https://www.spiceworks.com/tech/hardware/articles/direct-memory-access/</a></p>
</li>
<li>
<p>University of Michigan. "AMBA AHB-Lite SPECIFICATION." Disponível em: <a href="https://www.eecs.umich.edu/courses/eecs373/readings/ARM_IHI0033A_AMBA_AHB-Lite_SPEC.pdf">https://www.eecs.umich.edu/courses/eecs373/readings/ARM_IHI0033A_AMBA_AHB-Lite_SPEC.pdf</a></p>
</li>
<li>
<p>"RP2040 Datasheet." Disponível em: <a href="https://datasheets.raspberrypi.com/rp2040/rp2040-datasheet.pdf?_gl=1133hn0o_gaNzczNjI3NTcwLjE3MDA1OTg2MjI._ga_22FD70LWDS">https://datasheets.raspberrypi.com/rp2040/rp2040-datasheet.pdf?_gl=1133hn0o_gaNzczNjI3NTcwLjE3MDA1OTg2MjI._ga_22FD70LWDS</a>*MTcxMTQ3MzYxOC4yMi4xLjE3MTE0NzQyMDguMC4wLjA</p>
</li>
<li>
<p>"Raspberry Pi Pico W Datasheet." Disponível em: <a href="https://datasheets.raspberrypi.com/picow/pico-w-datasheet.pdf?_gl=1cxqmyl_gaNzczNjI3NTcwLjE3MDA1OTg2MjI._ga_22FD70LWDS">https://datasheets.raspberrypi.com/picow/pico-w-datasheet.pdf?_gl=1cxqmyl_gaNzczNjI3NTcwLjE3MDA1OTg2MjI._ga_22FD70LWDS</a>*MTcxMTQ3MzYxOC4yMi4xLjE3MTE0NzQzNzYuMC4wLjA</p>
</li>
<li>
<p>"Raspberry Pi Pico C/C++ SDK." Disponível em: <a href="https://datasheets.raspberrypi.com/pico/raspberry-pi-pico-c-sdk.pdf?_gl=11jwcl4q_gaNzczNjI3NTcwLjE3MDA1OTg2MjI._ga_22FD70LWDS">https://datasheets.raspberrypi.com/pico/raspberry-pi-pico-c-sdk.pdf?_gl=11jwcl4q_gaNzczNjI3NTcwLjE3MDA1OTg2MjI._ga_22FD70LWDS</a>*MTcxMTQ3MzYxOC4yMi4xLjE3MTE0NzQzNzYuMC4wLjA</p>
</li>
</ul>


</section>
          
        
      </main>
      <footer class="ah-footer ah-typeset">
        <div class="ah-footer-nav">
          
            <a href="../rp2040-i2c/"
               class="ah-prev"
               title="I2C">
              <span class="nav-label">Previous</span>
              <span class="nav-title">I2C</span>
            </a>
          
          
            <a href="../rp2040-uart/"
               class="ah-next"
               title="UART">
              <span class="nav-label">Next</span>
              <span class="nav-title">UART</span>
            </a>
          
        </div>
      </footer>
    </div>
    
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><script src="../../termynal.js"></script>
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
</script></body>
</html>